import xml.etree.ElementTree as ET

def parse_flow_stats(xml_file):
    # Load and parse the XML file
    tree = ET.parse(xml_file)
    root = tree.getroot()

    print(f"{'Flow ID':<10}{'Protocol':<10}{'Tx Packets':<12}{'Rx Packets':<12}{'Lost Packets':<12}{'Throughput (Mbps)':<20}{'Delay (s)':<12}{'Jitter (s)':<12}")

    # Iterate over each flow in the FlowMonitor XML
    for flow in root.findall('FlowStats/Flow'):
        flow_id = flow.find('flowId').text
        tx_packets = int(flow.find('txPackets').text)
        rx_packets = int(flow.find('rxPackets').text)
        lost_packets = int(flow.find('lostPackets').text)
        delay_sum = float(flow.find('delaySum').text)
        jitter_sum = float(flow.find('jitterSum').text)
        throughput = float(flow.find('throughput').text)

        # Determine the protocol based on flow ID
        protocol = determine_protocol(flow_id)

        # Print the statistics for each flow
        print(f"{flow_id:<10}{protocol:<10}{tx_packets:<12}{rx_packets:<12}{lost_packets:<12}{throughput:<20}{delay_sum:<12.6f}{jitter_sum:<12.6f}")

def determine_protocol(flow_id):
    """ Determine the protocol based on the flow ID. You can adjust this mapping as needed. """
    flow_id = int(flow_id)
    if flow_id % 4 == 1:
        return "TCP"
    elif flow_id % 4 == 2:
        return "UDP"
    elif flow_id % 4 == 3:
        return "SCTP"
    elif flow_id % 4 == 0:
        return "DCCP"
    else:
        return "Unknown"

if __name__ == "__main__":
    # Path to the XML file generated by NS-3 FlowMonitor
    xml_file = "vanet_flowmon.xml"
    
    # Parse and print the flow statistics
    parse_flow_stats(xml_file)
